version: "3.8"

services:
    web:
        image: nginx:alpine
        ports:
            - "8080:80"
        volumes:
            - ./html:/usr/share/nginx/html:ro
        depends_on:
            - api
        environment:
            - NGINX_HOST=localhost
            - NGINX_PORT=80
        network_mode: host
        platform: linux/arm64
        privileged: true

    api:
        image: oven/bun:alpine
        working_dir: /app
        volumes:
            - ./api:/app
        ports:
            - "3000:3000"
        command: ["bun", "server.js"]
        environment:
            - NODE_ENV=development
            - PORT=3000
        depends_on:
            - db
        network_mode: host
        platform: linux/arm64

    db:
        image: redis:alpine
        command: redis-server --requirepass testpass
        volumes:
            - redis_data:/data
        ports:
            - "6379:6379"
        network_mode: host
        platform: linux/arm64

# networks:
#     host:
#         driver: host

volumes:
    redis_data:
# networks:
#     default:
#         driver: host
